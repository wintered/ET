library(tidyverse)
library(ggplot2)

data<- read.csv("csv/cumulative_time.csv.avg", sep = ',')
data$family<- factor(data$family,levels = c("Z3", "CVC4/5"))
data$theory<- factor(data$theory,levels = c("Core", "Ints", "Reals", "RealInts","Bitvectors", "Arrays", "FP", "Strings","Optimization", "Bags"))
sol_levels <- sapply(readLines("../solvers.cfg"), function(line) strsplit(line, " ")[[1]][1])
sol_levels <- rev(sol_levels[-c(1:3)])

data$solver =  factor(data$solver,levels = sol_levels)
data <- na.omit(data)
plt <- ggplot(data, aes(y=cumulative_time,x=solver,label=cumulative_time,ymin=0)) 
plt <- plt + theme_minimal()
plt <- plt + geom_bar(stat="identity",alpha = 0.8, width = 0.75)
plt <- plt + theme(axis.text.x=element_text(angle=60, hjust=1))
plt <- plt + scale_y_continuous(
    labels = function(x) paste0(format(x, big.mark = ",", scientific = FALSE), "s")
)
plt <- plt + facet_grid(rows = vars(theory), cols= vars(family), scales="free",space = "free_x")
plt <- plt + theme(axis.text = element_text(size = 8))
plt <- plt + theme(strip.text.y = element_text(size = 8),panel.spacing = unit(1.2, "lines"))
plt <- plt + scale_fill_hue(c=45, l=80)
plt <- plt + labs(x = "solver", y = "runtime (s)")
#plt <- plt + theme(panel.grid.major.x = element_blank(),panel.grid.minor.x = element_blank())
plt <- plt + theme(legend.position="top",legend.title = element_blank()) 
plt <- plt + theme(panel.grid.major = element_line(colour = alpha("gray", 0.1)),panel.grid.minor = element_line(colour = alpha("gray", 0.1)))
plt <- plt + theme(strip.text.x = element_text(size = 11,face="bold"))
plt <- plt + theme(strip.text.y = element_text(size = 11,face="bold"))
ggsave("plots/cumulative-time-plot.pdf", width=32, height=23, units = "cm")
